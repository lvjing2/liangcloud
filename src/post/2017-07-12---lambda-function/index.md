---
path: "/blog"
date: "2017-07-12T17:12:33.962Z"
title: "无服务云计算"
tags: 
    - "lambda"
draft: false
---

##Aws lambda的使用体验


### Aws lambda的server less计算的使用过程中存在的问题

####运行状态追踪
对于lambda使用者来说，部署的程序需要有大量的节点进行并行计算，如何追踪这些大量的节点的运行状态并把握整体的进度，lambda这种serverless 的计算服务是没有提供这种功能的，所以这就需要lambda使用者来说是需要自己设计方案实现的。一般每个节点的运行都有以下5种状态:
- pending
- running
- success
- fail
- warning


那么如何实现这样的方案呢？

首先，需要每个计算结点都能记录并更新自己的运行状态，并储存在一个公共的存储节点上。这里我们将每个节点的状态记录在`${UUID}.process`文件中，并上传到S3中。但如何更新每个节点的运行状态呢？这里我们将这5种状态分别存放于不同的文件夹中，当需要更新的时候，需要删除原状态文件夹中的`.process`文件，并生成新的`.process`文件并上传至新的状态文件夹中。这样可以比较好的记录并更新每个节点的状态信息。

####运行异常处理
每个节点都有可能会在意想不到的地方抛出异常失败，每个节点的异常如果不在程序中捕获处理，那么就会被lambda平台捕获，并触发重试，如果重试3次还失败，则改节点的计算就失败了。
但是lambda重试3次后失败了，节点的运行状态文件还必须在程序退出前更新好。这还必须开发者在程序中对失败重试次数进行计数，如果到达3次了，就将`.process`文件从running移动至faid文件夹。当然如果我们不需要使用lambda默认的重试3次功能的话，那我们可以把所有的异常都捕获住，然后直接开始更新状态文件，这样的程序会更简洁些。

####Lambda的使用限制
每个function的限制还是比较多的.
- 每个最长运行5min.
- 每个bucket最多只能有100个lambda function.
- 每个账号能注册的bucket数量也有限制.
- 一个role触发的同时计算的结点数最多只有3000个.
- ...
    
    
####S3的数据一致性
- 在S3中进行覆盖操作是eventual consistency，也就是说当覆盖一个文件之后，立马获取该文件，得到的可能还是老版本数据。
- 但是当进行create，copy操作时，是read-after-write consistency,也就是说在这两种操作下，立马获取该文件，是可以得到最新的数据的。
- 要获取某一文件夹下文件的数量时，amazon并没有提供这样的借口，必须由开发者把所有的文件list一遍，然后统计数量。这当文件数量非常大的时候，这样的操作就会非常的耗时。。如果amazon本身提供这样的接口，其实这样在服务器内部list并计数一下就可以得到数值并返回了，就不需要用户远程地list所有的文件出来了，这样可以减少很多网络消耗和等待时间。。
  
   